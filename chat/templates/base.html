{% load static %}
{% load chattags %}
<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>

    <link rel='stylesheet' href='https://site-assets.fontawesome.com/releases/v6.4.0/css/all.css'>

    <link rel="stylesheet" href="/static/css/base.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"
        type="text/javascript"></script>

    {% block head %}{% endblock %}


    <title>{% block title %}{% endblock %} Djangogram</title>
</head>

<body>
    <div id="sidebar">
        <div id="split-bar"></div>
        <div class="sidebar">
            <div class="usercard">
                <div class="profileimage">
                    <div>{{user.username|slice:"0:1"}}</div>
                </div>
                <div class="profileinfo">
                    <p class="profileinfoname">{{user.username}}</p>
                    <p class="profileinfoemail">{{user.email}}</p>
                </div>
                <div class="themetoggle">
                    <i class="fas fa-moon-stars"></i>
                </div>
            </div>

            <div class="searchbar">
                <input type="text" placeholder="Search..." id="searchbar" />
                <button onclick="document.getElementById('searchbar').value=''">
                    <i class="fas fa-xmark"></i>
                </button>
            </div>
            <div class="contactlist">
                {% for lroom in rooms %}
                {% if room and room.name == lroom.name %}
                <div class="contactcard active" data-room="{{lroom|room_to_private:user}}">
                    {% else %}
                    <div class="contactcard" data-room="{{lroom|room_to_private:user}}" onclick='openchat(this)'>
                        {% endif %}
                        <div class="contactimage">
                            <div>{{lroom|room_to_private:user|slice:"0:1"}}</div>
                        </div>
                        <div class="contactinfo">
                            <p class="contactinfoname">{{lroom|room_to_private:user}}</p>
                            <p class="contactlastmsg">This is a {{lroom.type}} chat</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div id="main">
            {% block content %}
            {% endblock %}
        </div>
        <!-- partial -->
        <script src='//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
        <script src="/static/js/resizer.js"></script>
        <script src="/static/js/moment.min.js"></script>
        <script>
            document.querySelector(".themetoggle").addEventListener("click", (e) => {
                console.log("changing theme");
                document.querySelector("body").classList.toggle("darktheme")
            })

            document.getElementById("searchbar").addEventListener("input", (e) => {
                if (e.target.value != "") {
                    document.querySelector(".searchbar button").style.display = "block";
                }
                else {
                    document.querySelector(".searchbar button").style.display = "none";
                }
            })


            function openchat(element) {
                const chatroom = element.dataset.room;
                window.location.replace(`/chat/${chatroom}`);
            }
        </script>
</body>

</html>